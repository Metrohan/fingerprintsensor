{% extends "base.html" %}

{% block content %}
<h1>ğŸ” BugÃ¼nÃ¼n YoklamasÄ±</h1>
<p class="muted">ğŸ“… Tarih: {{ date }}</p>

<!-- Fingerprint Match Section -->

<div class="cards">
  <div class="card">
    <div class="card-title">Toplam KayÄ±t</div>
    <div class="card-value">{{ total }}</div>
  </div>
  <div class="card">
    <div class="card-title">Åu An Ä°Ã§eride</div>
    <div class="card-value">{{ inside_count }}</div>
  </div>
  <div class="card">
    <div class="card-title">Ã‡Ä±kmÄ±ÅŸlar</div>
    <div class="card-value">{{ total - inside_count }}</div>
  </div>
</div>

<table class="table">
  <thead>
    <tr>
      <th>Ad</th>
      <th>Soyad</th>
      <th>ğŸ• Ä°lk GiriÅŸ</th>
      <th>ğŸ• Son Ã‡Ä±kÄ±ÅŸ</th>
      <th>â±ï¸ Toplam SÃ¼re</th>
      <th>ğŸ“Š Durum</th>
    </tr>
  </thead>
  <tbody>
    {% if records %}
      {% for r in records %}
        <tr class="{% if r.status == 'Girdi' %}row-inside{% else %}row-out{% endif %}">
          <td><strong>{{ r.first_name }}</strong></td>
          <td>{{ r.last_name }}</td>
          <td>{{ r.first_check_in if r.first_check_in else '-' }}</td>
          <td>{{ r.last_check_out if r.last_check_out else '-' }}</td>
          <td style="font-weight: 600; color: #667eea;">{{ r.duration_str if r.duration_str else '-' }}</td>
          <td>
            {% if r.status == 'Ä°Ã§eride' %}
              <span style="background: #dcfce7; color: #166534; padding: 4px 8px; border-radius: 4px; font-size: 0.85rem; font-weight: 500;">âœ… Ä°Ã§eride</span>
            {% else %}
              <span style="background: #fed7aa; color: #92400e; padding: 4px 8px; border-radius: 4px; font-size: 0.85rem; font-weight: 500;">ğŸšª DÄ±ÅŸarÄ±da</span>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="6" style="text-align:center; padding: 24px;">
          <em style="color: #9ca3af;">BugÃ¼n iÃ§in henÃ¼z kayÄ±t yok.</em>
        </td>
      </tr>
    {% endif %}
  </tbody>
</table>

<script>
function matchFingerprint() {
  const statusDiv = document.getElementById('match-status');
  const resultDiv = document.getElementById('match-result');
  const userInfoDiv = document.getElementById('match-user-info');
  
  statusDiv.innerHTML = 'â³ ParmaÄŸÄ±nÄ±zÄ± sensÃ¶re yerleÅŸtirin...';
  resultDiv.style.display = 'none';
  
  fetch('/api/match-fingerprint')
    .then(response => response.json())
    .then(data => {
      if (data.status === 'ok') {
        const eventText = data.event === 'check_in' ? 'ğŸŸ¢ GiriÅŸ YapÄ±ldÄ±' : 'ğŸ”´ Ã‡Ä±kÄ±ÅŸ YapÄ±ldÄ±';
        statusDiv.innerHTML = 'âœ… EÅŸleÅŸme BaÅŸarÄ±lÄ±!';
        userInfoDiv.innerHTML = `
          <div style="font-size: 1.4rem; font-weight: 700; margin-bottom: 12px;">
            ${eventText}
          </div>
          <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 8px;">
            ğŸ‘¤ ${data.user}
          </div>
          <div style="font-size: 0.95rem; opacity: 0.9;">
            ğŸ†” Parmak Ä°zi ID: ${data.fingerprint_id}
          </div>
        `;
        resultDiv.style.display = 'block';
        
        // Auto-refresh after 2 seconds to show updated attendance
        setTimeout(() => {
          window.location.reload();
        }, 2000);
      } else {
        statusDiv.innerHTML = 'âŒ ' + (data.msg || 'EÅŸleÅŸme baÅŸarÄ±sÄ±z');
        resultDiv.style.display = 'none';
      }
    })
    .catch(error => {
      statusDiv.innerHTML = 'âŒ BaÄŸlantÄ± hatasÄ±: ' + error.message;
      resultDiv.style.display = 'none';
    });
}
</script>
{% endblock %}
